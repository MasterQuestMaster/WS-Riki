---
import MainLayout from '@layouts/MainLayout.astro';
import SearchHeader from '@components/SearchHeader.astro';

import { db, eq, Card, Set } from 'astro:db';
import { dbarray } from 'src/scripts/db-utils';

const { cardid = "" } = Astro.params;
console.log(cardid);

const selectCardResult = await db.select().from(Card)
    .innerJoin(Set, eq(Card.setId, Set.id))
    .where(eq(Card.id, cardid))
    .get();

if(!selectCardResult) {
    return new Response(null, {
        status: 404,
        statusText: 'Not found'
    });
}

const card = selectCardResult.Card;
const set = selectCardResult.Set;

---
<MainLayout>
    <SearchHeader />
    <main>
        <div class="card">
            <p>Code: {card.cardno}</p>
            <p>Card Name: {card.name}</p>
            <p>Type: {card.type}</p>
            <p>Color: {card.color}</p>
            <p>Rarity: {card.rarity}</p>
            <p>Expansion: {set.name}</p>
            <p>Level: {card.level}</p>
            <p>Cost: {card.cost}</p>
            <p>Power: {card.power}</p>
            <p>Soul: {card.soul}</p>
            <p>
                Trigger: {dbarray(card.trigger).map(trigger => 
                <div class="trigger-icon">{trigger}</div>)}
            </p>
            <p>
                Traits: {dbarray(card.traits).map(trait => 
                <div class="trait">{trait}</div>)}
            </p>
            <p>Abilities ({dbarray(card.abilities).length}): {dbarray(card.abilities).join("\n")}</p>
            <p>Tags: {dbarray(card.tags).map(tag =>
                <div class="tag">{tag}</div>)}
            </p>
            <img src={card.image} alt={card.name} />
        </div>
    </main>
</MainLayout>